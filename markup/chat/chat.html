<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <title>채팅방 마크업 샘플</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0">
  <meta name="description" content="">

  <!-- Bootstrap 4.6.0 -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="./chat.css">
</head>
<body>

<div class="d-flex flex-column">
  
  <!-- header bar -->
  <header class="fixed-top header-main title">
    <section class="container-fluid top-nav between">
      <a href="#;" class="btn btn-icon" title="이전으로" onclick="history.back();">
        <span class="icon icon-left icon-ml back"></span>
      </a>
      <h1>채팅방 제목</h1>
      <button type="button" class="icon icon-out icon-ml" data-toggle="modal" data-target="#chatQuit">
        <span class="sr-only">채팅방 닫기</span>
      </button>
    </section>
  </header>

  <main class="d-flex h-100 flex-column ui ui-comment">
    <div class="container pt-3 chat-container">
      <div class="chat-notice">
        채팅 공지사항입니다.
      </div>
      <div class="chat-date">
        2020년 10월 20일
      </div>
      <article class="chat-box recieve">
        <div class="profile">
          <a href="#" class="userthumb userthumb-md" style="background-image: url('https://png.pngtree.com/png-vector/20190710/ourmid/pngtree-user-vector-avatar-png-image_1541962.jpg');" title="프로필썸네일"></a>
        </div>
        <div>
          안녕하세요 요앞상회입니다. 때에, 웅대한 풍부하게 못할 든 이상을 찾아 작고 있다. 동산에는 인생을 인류의 사랑의 이 웅대한 천하를 이것이다.
        </div>
        <span class="time">11:12</span>
      </article>
      <article class="chat-box chat-box-image recieve">
        <div class="profile">
          <a href="#" class="userthumb userthumb-md" style="background-image: url('https://png.pngtree.com/png-vector/20190710/ourmid/pngtree-user-vector-avatar-png-image_1541962.jpg');" title="프로필썸네일"></a>
        </div>
        <div class="image-box svg-spinner" style="background: url('https://www.teahub.io/photos/full/93-935601_fondos-de-pantalla-hd-4k-horizontal.jpg');" data-imgurl="https://www.teahub.io/photos/full/93-935601_fondos-de-pantalla-hd-4k-horizontal.jpg"></div>
        <span class="time">15:45</span>
      </article>  
      <article class="chat-box send unread">
        <div>
          청춘의 만물은 살았으며, 인간은 싶이 갑 할지라도 것이다. 없는 뼈 것은 어디 굳세게 이 있다.
        </div>
        <span class="time">11:12</span>
      </article>
      <article class="chat-box chat-box-image send">
        <div class="image-box svg-spinner" style="background: url('https://data.1freewallpapers.com/download/the-milky-pink-sea-at-milford-sound-new-zealand-4k-5k.jpg');" data-imgurl="https://www.benq.com/content/dam/b2c/en-sg/campaign/4k-monitor/d-4k-monitor-01.jpg"></div>
        <span class="time">15:45</span>
      </article>
      <article class="chat-box chat-box-image send unread">
        <div class="image-box" style="background: url('https://i.pinimg.com/originals/72/40/55/724055733047bec21ad96ce4dad37013.jpg');" data-imgurl="https://i.pinimg.com/originals/72/40/55/724055733047bec21ad96ce4dad37013.jpg"></div>
        <span class="time">15:45</span>
      </article>
      <article class="chat-box send unread">
        <div>
          청춘의 만물은 살았으며, 인간은 싶이 갑 할지라도 것이다.
        </div>
        <span class="time">15:45</span>
      </article>
    </div>
  </main>
  <!-- 차단 정보 -->
  <section class="chat-block-info">
    <p>
      차단한 대화 상대와 대화가 불가능합니다 
    </p>
  </section>

  <!-- pop Image Container -->
  <div class="image-popup">
    <!-- <div class="pinch-zoom"></div> -->
    <div class="btn-group zoom">
      <button type="button" class="icon icon-close color_white icon-lg" aria-label="닫기"></button>
      <a href="#" download="ImageName" class="icon icon-download color_white icon-lg" title="다운로드"></a>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal fade" id="chatQuit" tabindex="-1" aria-labelledby="chatQuitLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <h5 class="modal-title info" id="chatQuitLabel">채팅방에서 나가시겠습니까?</h5>
          <p class="text-center my-4">
            나가기를 하면 대화내용이 사리지고<br>채팅목록에서도 삭제됩니다.
          </p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-primary btn-lg btn-fix" data-dismiss="modal">아니요</button>
          <button type="button" class="btn btn-primary btn-lg btn-fix">예</button>
        </div>
      </div>
    </div>
  </div>

  <!-- chat input -->
  <footer class="footer footer-comment fixed-bottom">
    <div class="container-fluid h-100">
      <button type="button" class="icon icon-add color_coolgrey" onclick="attach();">
        <span class="sr-only">이미지 첨부</span>
      </button>
      <label for="chat" class="sr-only">답글</label>
      <textarea name="chat" id="chat" class="form-control" rows="1" placeholder=""></textarea>
      <button type="button" class="btn btn-text chat">
        <i class="icon icon-send color_primary"></i>
        <span class="sr-only">보내기</span>
      </button>
    </div>
    <div class="attach" id="attachFile">
      <section class="attach-bar px-3">
        <label for="uploadFiles" class="icon icon-plus icon-lg m-0">
          <input type="file" id="uploadFiles" accept=".jfif,.jpg,.jpeg,.png,.gif" class="sr-only" multiple>
          <span class="sr-only">파일선택</span>
        </label>
        <button type="button" class="icon icon-upload">
          <span hidden>파일 Post</span>
        </button>
      </section>
      <section class="attach-thumb" id="previewThumbs">
        <div class="attach-thumb-item" style="background-image: url('/images/demo_banner.jpg');">
          <i class="icon icon-trash"></i>
        </div>
        <div class="attach-thumb-item">
          <i class="icon icon-trash"></i>
        </div>
        <div class="attach-thumb-item">
          <i class="icon icon-trash"></i>
        </div>
        <div class="attach-thumb-item">
          <i class="icon icon-trash"></i>
        </div>
        <div class="attach-thumb-item">
          <i class="icon icon-trash"></i>
        </div>
      </section>
    </div>
  </footer>

</div>


<!-- <script src="/js/jquery-3.5.1.min.js"></script> -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js" crossorigin="anonymous"></script>

<!-- Bootstrap 4.6.0 -->
<!-- <script src="/js/bootstrap.bundle.min.js"></script> -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- Image Pinch-zoom -->
<!-- <script src="/js/pinch-zoom.umd.js"></script> -->
<script src="https://cdn.jsdelivr.net/npm/pinch-zoom-js@2.3.4/dist/pinch-zoom.umd.min.js" crossorigin="anonymous"></script>

<!-- JS 요소 로딩 라이브러리 -->
<!-- <script src="/js/jquery.waitforimages.min.js"></script> -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.waitforimages/2.4.0/jquery.waitforimages.min.js" crossorigin="anonymous"></script>

<script>
  // 파일첨부
  function attach() {
    var state = document.getElementById("attachFile");
    state.classList.toggle("show");
  }

  // 채팅 스크롤 액션
  $(function(){
    // 채팅 진입시 하단 스크롤
    $("html, body").animate({ scrollTop: $(document).height() }, 100);

    // 채팅 영역 클릭시 첨부 이미지 창 제거
    $('.chat-container').on('click', function(){ 
      $('#attachFile').removeClass('show');
    });

    $("#chat").on('focus', function(){
    // 입력창 포커싱되면  화면 하단 포커싱
      $("html, body").animate({ scrollTop: $(document).height() }, 500);
    });
    $(".btn-text.chat").on('click', function(){
      // 전송 버튼 클릭시 화면 하단 포커싱
      $("html, body").animate({ scrollTop: $(document).height() }, 500);
    });
    // 엔터키 입력시 입력창 확장
    $('#chat').on('keypress', function(e){
      var key = e.which;
      if (key == 13) {
        $(".ui-comment, .footer-comment").addClass('expand');
        $(this).addClass('expand');
        $("body, html").animate({ scrollTop: $('.fixed-chat').height() }, 300);
        // return false;
      }
    });
    // Ctrl + Enter 키 입력
    $('#chat').keydown(function (e) {
      if (e.ctrlKey && e.keyCode == 13) {
        $('.btn-text.chat').trigger('click');
      }
    });
    // 전송버튼 클릭시 입력창 원복 및 입력 내용 지우기
    $('.btn-text.chat').on('click', function(){
      $(".ui-comment, .footer-comment").removeClass('expand');
      $("#chat").removeClass('expand').val("");
    });
    
  });
  

  // 첨부이미지 크게 보기
  // Image Zoom & download Popup
  $('.image-box').on('click', function() {
    var status = $('.image-popup').hasClass('active');
    var imgurl = $(this).data("imgurl");
    var imgEl = $('<img src="' + imgurl + '" />');

    if(!status) {
      $('.image-popup').prepend('<div class="pinch-zoom"></div>');
      $('.image-popup').addClass('active').find('.pinch-zoom').append(imgEl);
      $('.icon-download color_white').attr({
        'href': imgurl,
        'download': imgurl
      });
      $('main').modal('show');
      var el = document.querySelector('div.pinch-zoom');
      new PinchZoom.default(el, {
        minZoom: 1,
      });
    } 
    // Close Image Popup
    $('.icon-close').on('click', function() {
      $('.image-popup').removeClass('active').children('.pinch-zoom-container').remove();
      $('main').modal('hide');
    })
  })

  // Loading progress for Image items
  $('.image-box').waitForImages({
    hasImgProperties: ['backgroundImage'],
    finished: function() {
      $('.image-box').removeClass('svg-spinner');
      $("html, body").animate({ scrollTop: $(document).height() }, 100);
    },
    each: function() {
    },
    waitForAll: true
  })

  // 채팅방 나가기 dialog modal
  // $('#quitChat').on('click', function () {
  //   swal({
  //     title: "채팅방에서 나가시겠습니까?",
  //     text: "나가기를 하면 대화내용이 사리지고<br>채팅목록에서도 삭제됩니다.",
  //     // icon: "warning",
  //     buttons: true,
  //     dangerMode: true,
  //     buttons: {
  //       cancel: {
  //         text: "취소",
  //         value: null,
  //         visible: true,
  //         className: "btn btn-outline-primary",
  //         closeModal: true,
  //       },
  //       confirm: {
  //         text: "신고하기",
  //         value: true,
  //         visible: true,
  //         className: "btn btn-primary",
  //         closeModal: true
  //       }
  //     }
  //   })
  // });

</script>
</body>
</html>